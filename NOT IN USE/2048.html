<!doctype html>
<html>
    <head>

        <style>
            div {
                width: 100px;
                height: 100px;
                position: absolute;
                transition: 0.5s;
            }

            #butt {
                margin-left: 500px;
            }

            #board {
                width: 400px;
                height: 400px;
                border: 1px solid blue;
            }

            .removed {
                background: rgba(255, 255, 255, 0);
                margin-top: -200px;
                transition: 0s;
            }

            .block2 {
                background: rgb(0, 0, 0);
            }

            .block4 {
                background: rgb(107, 107, 107)
            }

            .block8 {
                background: rgb(0, 56, 3);
            }

            .block16 {
                background: green;
            }

            .block32 {
                background: rgb(0, 255, 13);
            }

            .block64 {
                background: violet;
            }

            .block128 {
                background: purple;
            }

            .block256 {
                background: rgb(168, 19, 43);
            }

            .block512 {
                background: red
            }

            .block1024 {
                background: rgb(255, 94, 0);
            }

            .block2048 {
                background: gold;
            }
        </style>

    </head>
    <body>
        

        <div id="board">

        </div>
            
        <script>

            window.onload = createRandomBlock;

            var numberOfX = 4;
            var numberOfY = 4;
        
            var gameboard = [[],[],[],[]];

            for (var y = 0; y < numberOfY; y++) {
                console.log(gameboard);
                for (var x = 0; x < numberOfX; x++) {         //populates board with 0s
                    gameboard[x].push(0);
                }
            }

            //test start
            console.log(gameboard);

            // gameboard[3][0] = 8;    

            // document.getElementById("board").innerHTML += "<div id='0x3' class='block8' style='margin-top:300px;'></div>";
            // document.getElementById("board").innerHTML += "<div id='0x2' class='block8' style='margin-top:200px;'></div>";
            // //test end


            window.addEventListener('keydown', function(e) {
                switch (e.keyCode) {
                    case 38:
                        move('up');
                        break;
                    case 40:
                        move('down');
                        break;
                    case 37:
                        move('left');
                        break;
                    case 39:
                        move('right');
                        break;
                }
            });




            function createRandomBlock() {
                var anySpotAvailable = false;
                for (var x = 0; x < numberOfX; x++) {
                    for (var y = 0; y < numberOfY; y++) {
                        if (gameboard[y][x]===0) {
                            anySpotAvailable = true;       //test if there are any spots available
                        }                                   //if there aren't, don't proceed
                    }
                }
                
                while (anySpotAvailable) {              //loop indefinetly
                    var tempx = Math.floor(Math.random()*4); //create random x 0-3
                    var tempy = Math.floor(Math.random()*4); //create random y 0-3
                    console.log(tempx + ' ' + tempy);
                    if (gameboard[tempy][tempx] === 0) { //check if available
                        var tempBlock = Math.floor(Math.random()*2+1) * 2; //randomly creates a number 2 or 4
                        gameboard[tempy][tempx] = tempBlock; //assigns 2 or 4 to available block
                        console.log(gameboard[tempy][tempx]);
                        document.getElementById("board").innerHTML += "<div id='"+tempx+"x"+tempy+"' class='block"+tempBlock+"' style='margin-left: "+tempx*100+"px; margin-top: "+tempy*100+"px'></div>";
                        return; //exits loop if available square is found, and square is set
                    }
                }

                console.log("No more spots available");
            }






            
            function move(d) {

                if (d === 'down') {
                    for (var x = 0; x < numberOfX; x++) {
                        for (var y = 3; y > 0; y--) {
                            if (gameboard[y][x] === gameboard[y-1][x] && gameboard[y][x] != 0) {
                                gameboard[y][x] = gameboard[y][x]*2;
                                gameboard[y-1][x] = 0;
                                document.getElementById(x+"x"+y).className = "block" + gameboard[y][x];
                                document.getElementById(x+"x"+(y-1)).className = "removed";
                                document.getElementById(x+"x"+(y-1)).id = "x";
                            }
                        }
                        var control = true;
                        while (control) {
                            control = false;
                            for (var t = 3; t > 0; t--) {
                                if (gameboard[t][x] === 0 && gameboard[t-1][x] != 0) {
                                    gameboard[t][x] = gameboard[t-1][x];
                                    gameboard[t-1][x] = 0;
                                    document.getElementById(x+"x"+Number(t-1)).style.marginTop = t*100 + "px";
                                    document.getElementById(x+"x"+Number(t-1)).id = x+"x"+t;
                                    control = true;
                                }
                            }
                        }                    
                    }
                } //end bracket if down
                else if (d === "up") {
                    for (var x = 0; x < numberOfX; x++) {
                        for (var y = 0; y < 3; y++) {
                            if (gameboard[y][x] === gameboard[y+1][x] && gameboard[y][x] != 0) {
                                gameboard[y][x] = gameboard[y][x]*2;
                                gameboard[y+1][x] = 0;
                                document.getElementById(x+"x"+y).className = "block" + gameboard[y][x];
                                document.getElementById(x+"x"+(y+1)).className = "removed";
                                document.getElementById(x+"x"+(y+1)).id = "x";
                            }
                        }
                        var control = true;
                        while (control) {
                            control = false;
                            for (var t = 0; t < 3; t++) {
                                if (gameboard[t][x] === 0 && gameboard[t+1][x] != 0) {
                                    gameboard[t][x] = gameboard[t+1][x];
                                    gameboard[t+1][x] = 0;
                                    document.getElementById(x+"x"+Number(t+1)).style.marginTop = t*100 + "px";
                                    document.getElementById(x+"x"+Number(t+1)).id = x+"x"+t;
                                    control = true;
                                }
                            }
                        }                    
                    }
                }//end bracket if up
                else if (d === "left") {
                    for (var y = 0; y < 4; y++) {
                        for (var x = 0; x < 3; x++) {
                            if (gameboard[y][x] === gameboard[y][x+1] && gameboard[y][x] != 0){
                                gameboard[y][x] = gameboard[y][x]*2;
                                gameboard[y][x+1] = 0;
                                document.getElementById(x+"x"+y).className = "block" + gameboard[y][x];
                                document.getElementById((x+1)+"x"+y).className = "removed";
                                document.getElementById((x+1)+"x"+y).id = "x";
                            }
                        }
                        var control = true;
                        while (control) {
                            control = false;
                            for (var t = 0; t < 3; t++) {
                                if (gameboard[y][t] === 0 && gameboard[y][t+1] != 0) {
                                    gameboard[y][t] = gameboard[y][t+1];
                                    gameboard[y][t+1] = 0;
                                    document.getElementById(Number(t+1)+"x"+y).style.marginLeft = t*100 + "px";
                                    document.getElementById(Number(t+1)+"x"+y).id = t+"x"+y;
                                    control = true;
                                }
                            }
                        }
                    }
                }//end bracket if left
                else if (d === "right") {
                    for (var y = 0; y < 4; y++) {
                        for (var x = 3; x > 0; x--) {
                            if (gameboard[y][x] === gameboard[y][x-1] && gameboard[y][x] != 0){
                                gameboard[y][x] = gameboard[y][x]*2;
                                gameboard[y][x-1] = 0;
                                document.getElementById(x+"x"+y).className = "block" + gameboard[y][x];
                                document.getElementById((x-1)+"x"+y).className = "removed";
                                document.getElementById((x-1)+"x"+y).id = "x";
                            }
                        }
                        var control = true;
                        while (control) {
                            control = false;
                            for (var t = 3; t > 0; t--) {
                                if (gameboard[y][t] === 0 && gameboard[y][t-1] != 0) {
                                    gameboard[y][t] = gameboard[y][t-1];
                                    gameboard[y][t-1] = 0;
                                    document.getElementById(Number(t-1)+"x"+y).style.marginLeft = t*100 + "px";
                                    document.getElementById(Number(t-1)+"x"+y).id = t+"x"+y;
                                    control = true;
                                }
                            }
                        }
                    }
                }//end bracket if right

                setTimeout(createRandomBlock, 500);
            } //end bracket for function move



        </script>
    </body>
</html>